# Architecture Brief: Nebula-Engine (星云引擎)

Version: 0.1 (Draft)

Status: Conceptual Stage

author: Jabbey

date: 2026年1月

## Project Positioning - 核心定位

### 一句话定位

Nebula-Engine(星云引擎)：**一款面向开发者的轻量级嵌入式业务规则自动化引擎。**

### 服务对象 (For Whom)

* 中小型应用的后端开发者

* 大型系统中负责处理**规则频繁变更**、需要**高度灵活性**业务模块的开发者与架构师

### 核心痛点 (Problem Statement)

Nebula-Engine 旨在解决业务系统中常见但难以优雅处理的问题：

* **选择困境**：开发者陷入“硬编码修改慢”与“重型引擎引入难”的两难选择

* **逻辑僵化**：业务判断逻辑复杂、多变、相互交叉，长期以 **if-else / hard-coded** 形式散落在核心业务流程中
* **复用性差**：相似逻辑无法抽象复用，重复开发
* **响应迟滞**：每次规则调整都需走完整开发-测试-发布流程
* **逻辑黑盒**：业务决策过程隐含在代码中，缺乏清晰的结构化表达，逐渐演变为“黑盒逻辑”

### 生态位与形态 (Niche & Form)

我们聚焦于**业务决策逻辑的编排**，而非**业务流程的管理**。

* **我们是 (What We Are)：** 业务逻辑的“胶水”与决策机。一个专注于“决策判断”的 **SDK / Library**，可无缝嵌入现有应用，用于承载和执行业务规则。
* **我们不是 (What We Are Not)：**
    * 一个重型的业务流程管理（BPM）平台;
    * 一个提供人工可视化编排的工具;
    * 一个长事务管理器;
    * 一个需要独立部署的中间件服务;

### 核心使命 (Mission)

将业务系统中**“多变、交叉、复杂”的判断逻辑**从命令式代码（Hard-coded）中剥离，转化为**声明式、可组合、可动态加载**的原子单元，实现业务逻辑与底层架构的彻底解耦。

### 核心价值 (Value Proposition)

* **研发侧 (Efficiency & Quality)：** 缓解“面条代码”，用标准化的逻辑编排替代碎片化的 `if-else`，降低业务规则变更对代码结构的侵入性，提高长期可维护性。
* **业务侧 (Agility & Transparency)：** 实现逻辑“热插拔”，规则变更无需重启服务或重新发布，缩短业务响应周期，极大地提升业务灵敏度，提升业务试错速度与市场响应能力。
* **平衡点 (Optimal Choice)：** 介于“硬编码”与“重型引擎（如 Drools）”之间，主打**极简抽象**与**低学习成本**。



## Conceptual Model - 概念模型

**引擎 (Engine)**

- **描述**：Engine 是规则评估与决策生成的运行时容器，是对外提供统一决策服务的核心入口。
- **职责**：加载`Rule(规则)`、接收`Context(上下文)`、匹配`Condition(条件)`、执行`Action(动作)`、响应`Decision(决策)`。
- **定位**：规则执行过程的**核心协调者与运行时宿主**
- **特性**：线程安全、轻量级、支持单例或多例、可观测性

**Context (上下文)：**

* **描述**：Context 是 Nebula-Engine 决策周期的**核心数据载体**，封装了决策所需的所有原始事实与过程状态。
* **定位**：决策原材料的“托盘”与状态存储的“工作台”

- **职责**：提供数据读取接口，并作为 `Action(动作)` 修改结果的存储介质。
- **特性**：自包含 (Self-contained)、生命周期内的一致性

**Condition (条件/判断器)：**

* **描述**：基于`Context(上下文)`的数据，通过 `Operator(操作符)` 构建的逻辑断言。
* **定位**：规则的“触发器”
* **职责**：用于评估当前 `Context(上下文)` 是否满足规则的触发前提。
* **约束**：其结果必须为布尔值（`true` 或 `false`）。
* **特性**： 幂等性（评估过程不应改变 `Context(上下文)` 的状态）。

**Action (动作/指令/执行器)：**

* **描述**：Action 表示规则命中后执行的原子能力单元。当`Condition(条件)=true`这些指令将被执行。

* **定位**：规则的“执行载体”

* **职责**：当条件满足时执行具体业务操作的**原子指令**。

* **特性**：原子性、幂等性、可配置

* **模式**：

    * **Mutation (变更型)：** 直接修改`Context(上下文)`里的数据（如：将订单状态设为“已折扣”）。

    - **Side-Effect (副作用型)：产生外部指令（如：消息通知、审计日志）。

**Rule (规则/指令)：**

* **描述**：一个独立的、具名的最小业务决策单元，它描述了“在什么条件下，应当触发哪些动作意图”。
* **构成**： `Rule = Name + Condition (When) + Action (Then) + Metadata (Priority/Tag)`
* **定位**：最小逻辑闭环(如果-那么)
* **意义**：它是业务逻辑的最小原子单位，具备独立存在和被复用的价值。

**Decision (决策)：**

- **描述**：引擎在处理完规则后，返回给调用方的“最终报告”。
- **形态**：包含了所有被触发的规则及其对应动作的集合。记录了“哪些规则被触发、触发的时间、执行了哪些 Action、Fact 最终的状态”。
- **定位**：业务系统的“执行凭据”
- **意义**：它不仅是结果，更是决策`轨迹 (Trace)`。
- **特性**：可追溯、可度量、可调试

**Execution Strategy (执行策略)：**

- **定义**：定义了规则之间的**冲突仲裁机制**（如：是执行第一条命中的，还是执行所有命中的）。

- **定位**：定义规则冲突与执行方式的“仲裁者”

- **职责**：解决“冲突”

- **V1.0 预设模式**：

    - **`Fire-First`**：仅执行命中的第一条规则，适用于互斥型决策。

    - **`Fire-All`**：执行所有命中的规则，适用于叠加型逻辑。

- **演进说明**：这是对你 `Strategy` 概念的简化落地。未来可演进为可插拔的策略对象。

**RuleChain (规则链)：**

- **定义**：多个 `Rule(规则)` 按照特定拓扑结构（顺序、分支、循环）组成的逻辑集合。
- **定位**：业务流程的全景图
- **职责**：解决“冲顺序”
- **类型**：顺序链、分支链、并行链、循环链
- **V1.0 状态**：**Out of Scope**（**暂不引入的核心概念**）。


## Runtime Model - 运行时模型




## Out of Scope - 非范围


## Evolution Points - 演进点

